# 单线程带宽聚合功能配置教程

## 概述

带宽聚合功能可以将多个小带宽的服务器组合起来，实现更高的总带宽传输能力。本教程将指导您如何配置单线程带宽聚合，实现多条线路的并行传输。

## 网络架构

在开始配置之前，我们需要准备以下网络环境：

### 服务器配置

- **机器A（入口服务器）**: IP 192.168.4.10，带宽 > 200M
- **机器B（转发端点1）**: IP 192.168.4.11，带宽 100M  
- **机器C（转发端点2）**: IP 192.168.4.12，带宽 100M
- **机器D（出口服务器）**: IP 192.168.4.13，带宽 > 200M

### 数据流向

```
用户 → 机器A → [机器B, 机器C] → 机器D → 目标服务器
     入口     并行转发        出口    最终目的地
```

通过这种架构，用户的流量将通过机器B和C并行传输，实现两条100M线路的带宽聚合，达到接近200M的总带宽。



## 第一步：添加转发端点

首先需要在管理界面中添加转发端点B、C、D。

<img src="https://img.coderluny.com:444/uploads/6cdaa2a0-8c7e-4f7c-98d4-856ff0794440.png" width="600" alt="添加转发端点界面">

添加完成后，系统将生成安装脚本。请将对应的安装脚本复制到机器B、C、D上执行，完成转发端点的部署。



## 第二步：配置聚合服务器

接下来创建一个新的服务器实例，用于带宽聚合功能。

<img src="https://img.coderluny.com:444/uploads/20fb0330-eb61-4301-867c-32cd65d5fe65.png" width="600" alt="新建服务器界面">

点击"高级选项"展开详细配置。

<img src="https://img.coderluny.com:444/uploads/168b16b6-2150-4fbc-9160-286be7d64e07.png" width="600" alt="高级选项界面">

### 关键配置

在高级选项中进行以下配置：
- **转发端点**：选择机器B和机器C作为并行转发节点
- **Tot服务器**：选择机器D作为出口服务器

<img src="https://img.coderluny.com:444/uploads/2aa111c8-c301-4b10-b85e-b39a7d69c712.png" width="600" alt="选择转发端点和Tot服务器">

配置完成后，复制生成的安装脚本到机器A上执行。

**注意**：同一台机器支持多次安装，安装脚本会自动检测并进行增量安装。

<img src="https://img.coderluny.com:444/uploads/ae7ac097-d2af-4564-88b7-4008996ef694.png" width="600" alt="生成的安装脚本">

## 第三步：配置端口转发

最后一步是添加端口转发规则，建立完整的数据传输链路。

<img src="https://img.coderluny.com:444/uploads/967c3d58-c228-4865-9f01-108f62f15db3.png" width="600" alt="添加转发界面">

在转发配置中选择刚刚创建的聚合服务器：

<img src="https://img.coderluny.com:444/uploads/7712c8f7-a047-4876-a25e-0e154d384414.png" width="600" alt="选择服务器">

配置转发规则，指定目标地址和端口：

<img src="https://img.coderluny.com:444/uploads/f63e730a-2f79-4ebf-b934-74f6bc7da7d7.png" width="600" alt="配置转发规则">

## 配置完成

至此，带宽聚合配置已经完成。整个数据流向如下：

1. **用户连接**：192.168.4.10:30000
2. **并行转发**：流量通过机器B和机器C并行传输
3. **汇聚出口**：数据在机器D汇聚
4. **最终目标**：机器D将数据转发到 2.2.2.2:123

通过这种配置，成功实现了机器B和机器C的带宽聚合，理论上可以达到两条线路带宽之和的传输效果。

## 带宽聚合原理

### 数据流示意图

```
用户数据包
    ↓
[机器A - 负载均衡]
    ↓
┌─────────┬─────────┐
│  机器B  │  机器C  │  ← 并行传输
│ 100M线路 │ 100M线路 │
└─────────┴─────────┘
    ↓         ↓
┌─────────────────────┐
│      机器D        │  ← 数据汇聚
│   200M+ 出口      │
└─────────────────────┘
    ↓
目标服务器(2.2.2.2:123)
```

### 性能优势

- **带宽叠加**：理论上可获得 100M + 100M = 200M 的总带宽
- **负载分担**：数据包在多条线路间智能分配
- **容错能力**：单条线路故障时，其他线路可继续工作
- **成本优化**：使用多个小带宽服务器替代单个大带宽服务器